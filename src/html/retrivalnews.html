<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OSIM Foundation News</title>
    <link rel="stylesheet" href="../css/bootstrap.min.css">
    <link rel="stylesheet" href="bootstrap-icons-1.11.1/bootstrap-icons.css">
    <style>
        /* Custom Styles */
        .news-section {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding-top: 5rem;
            padding-bottom: 5rem;
        }

        .card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: none;
        }

        .card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
        }

        .loading-balls {
            display: inline-block;
            width: 20px;
            height: 20px;
            margin-right: 10px;
            border-radius: 50%;
            background-color: #ff7e5f;
            animation: loading 1s infinite alternate;
        }

        @keyframes loading {
            from {
                transform: scale(0.8);
                opacity: 0.5;
            }
            to {
                transform: scale(1.2);
                opacity: 1;
            }
        }

        .card-stamp {
            font-size: 0.8rem;
            color: #6c757d;
            margin-bottom: 0.5rem;
        }

        .card-author {
            font-size: 0.9rem;
            color: #2d3e50;
            font-weight: bold;
        }

        .card-content {
            font-size: 1rem;
            color: #495057;
        }

        .read-more {
            color: #ff7e5f;
            font-weight: bold;
            cursor: pointer;
            text-decoration: underline;
        }

        .card-header {
            background: linear-gradient(135deg, #ff7e5f, #feb47b);
            color: white;
            padding: 1rem;
            border-bottom: none;
            border-radius: 0.5rem 0.5rem 0 0;
        }

        .card-body {
            background: white;
            border-radius: 0 0 0.5rem 0.5rem;
        }

        .decorative-line {
            width: 80px;
            height: 3px;
            background: linear-gradient(90deg, #ff7e5f, #feb47b);
            margin: 2rem auto;
        }
    </style>
</head>

<body>
    <!-- News Section -->
    <section class="news-section">
        <div class="container">
            <!-- Section Title -->
            <div class="text-center mb-5">
                <h1 class="display-4 fw-bold" style="color: #2d3e50;">Stay Updated: Discover the Latest News and Events</h1>
                <p class="fs-5 text-muted">Explore recent updates and initiatives from OSIM Foundation.</p>
                <div class="decorative-line"></div>
            </div>

            <!-- Custom Loading Element -->
            <div id="loading" class="text-center mb-5" style="display: none;">
                <div class="loading-balls"></div>
                <p class="fs-5">Loading...</p>
            </div>

            <!-- News Entries Container -->
            <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4" id="news-container">
                <!-- News entries will be dynamically added here -->
            </div>
        </div>
    </section>

    <!-- Firebase Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
    <script type="module">
        // Import Firebase SDKs
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
        import { getFirestore, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAh2op_p29Oe1YNUmoXzOP_xgrqK7LcqRM",
            authDomain: "osim-foundation.firebaseapp.com",
            projectId: "osim-foundation",
            storageBucket: "osim-foundation.appspot.com",
            messagingSenderId: "401345535402",
            appId: "1:401345535402:web:bba44429e25b6250e69fd3",
            measurementId: "G-9BRRBECHJF"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const firestore = getFirestore(app);

        // References to DOM elements
        const newsContainer = document.getElementById("news-container");
        const loadingElement = document.getElementById("loading");

        // Function to fetch and display news entries
        function fetchAndDisplayNews() {
            loadingElement.style.display = "block"; // Show loading element

            // Listen to Firestore collection for real-time updates
            const newsRef = collection(firestore, "news");
            onSnapshot(newsRef, (querySnapshot) => {
                loadingElement.style.display = "none"; // Hide loading element

                // Clear previous news entries
                newsContainer.innerHTML = "";

                // Iterate through each news entry
                querySnapshot.forEach((doc) => {
                    const newsEntry = doc.data();
                    const newsCard = createNewsCard(newsEntry);
                    newsContainer.appendChild(newsCard);
                });
            });
        }

        // Function to create a news card
        function createNewsCard(newsEntry) {
            const card = document.createElement("div");
            card.className = "col";
            card.innerHTML = `
                <div class="card h-100 shadow-sm rounded-3">
                    <div class="card-header text-center rounded-top">
                        <h5 class="card-title fs-5 fw-bold">${newsEntry.heading}</h5>
                    </div>
                    ${newsEntry.imageUrl ? `<img src="${newsEntry.imageUrl}" alt="${newsEntry.heading}" class="card-img-top rounded-top" style="height: 200px; object-fit: cover;">` : ''}
                    <div class="card-body p-4">
                        <p class="card-stamp small text-muted">${new Date(newsEntry.timestamp).toLocaleDateString()}</p>
                        <p class="card-author small text-primary">${newsEntry.miniTitle || "Mini Title"}</p>
                        <p class="card-content text-muted" data-full="${newsEntry.content}">
                            ${truncateText(newsEntry.content, 150)}
                        </p>
                        <p class="text-end d-none">
                            <span class="read-less text-primary fw-bold">Read Less</span>
                        </p>
                        <p class="text-end">
                            <span class="read-more text-primary fw-bold">Read More</span>
                        </p>
                    </div>
                </div>
            `;

            // Add click event to toggle full content
            const readMoreButton = card.querySelector(".read-more");
            const readLessButton = card.querySelector(".read-less");
            const cardContent = card.querySelector(".card-content");

            readMoreButton.addEventListener("click", () => {
                cardContent.textContent = cardContent.dataset.full; // Expand to full content
                readMoreButton.classList.add("d-none"); // Hide "Read More"
                readLessButton.classList.remove("d-none"); // Show "Read Less"
            });

            readLessButton.addEventListener("click", () => {
                cardContent.textContent = truncateText(cardContent.dataset.full, 150); // Collapse to preview
                readLessButton.classList.add("d-none"); // Hide "Read Less"
                readMoreButton.classList.remove("d-none"); // Show "Read More"
            });

            return card;
        }

        // Utility function to truncate text
        function truncateText(text, maxLength) {
            if (text.length > maxLength) {
                return text.slice(0, maxLength) + "...";
            }
            return text;
        }

        // Fetch and display news entries
        fetchAndDisplayNews();
    </script>
</body>
</html>